<?php
if($_POST){
    include("config.php");
    session_start();
    $language = $_GET["language"];
    $email = $_SESSION["email"];
    $name = $_SESSION["name"];
    $surname = $_SESSION["surname"];
    $currentAvatar = mysqli_query($connection,"SELECT avatar from users WHERE email = '$email' AND name = '$name' AND surname = '$surname' ");
    $cAvatar = mysqli_fetch_array($currentAvatar,MYSQLI_ASSOC);
    $cAvatarInfo = $cAvatar["avatar"];
    if(isset($_POST["avatar"]) && isset($_GET["language"])){
        $avatar = $_FILES['avatar']['name'];
        $extension = pathinfo($avatar,PATHINFO_EXTENSION);
        if($extension == "jpg" || $extension == "png" || $extension == "svg"){
            $uploaded_avatar = 'static/media/avatar/'.basename($_FILES['avatar']['name']);
            if(!move_uploaded_file($_FILES['avatar']['tmp_name'],$uploaded_avatar)){
                if($language  == "tr")header("location:/tr/hesapayarlari?&error=true");
                else if($language == "en")header("location:/en/accountsettings?&error=true");
            }
            $result = mysqli_query($connection,"UPDATE users SET avatar = '$avatar' WHERE email = '$email' AND name = '$name' AND surname = '$surname' AND avatar = '$cAvatarInfo' ");
            if($result){
                if($language  == "tr")header("location:/tr/hesapayarlari?&success=true");
                else if($language == "en")header("location:/en/accountsettings?&success=true");
            }else{
                if($language == "tr")header("location:/tr/hesapayarlari?&error=true");
                else if($language == "en")header("location:/en/accountsettings?&error=true");
            }
        }
        else{
            if($language  == "tr")header("location:/tr/hesapayarlari?&experror=true");
            else if($language == "en")header("location:/en/accountsettings?&experror=true");
        }
        
    }
    else {
        if($language == "tr")header("location:/tr/hesapayarlari?&fileerror=true");
        else if($language == "en")header("location:/en/accountsettings?&fileerror=true");
    }
}
?>