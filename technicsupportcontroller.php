<?php
    if(!isset($_GET["language"])){
        header("location:/");
    }

    if($_POST){
        $language = $_GET["language"];
        include("config.php");
        session_start();
        $email = $_SESSION["email"];
        $name = $_SESSION["name"]." ".$_SESSION["surname"];
        $order_code = $_POST["order_code"];
        $subject = $_POST["subject"];
        $info = $_POST["problem_info"];
        $file_path = "static/media/ts/";
        $uploaded_file = $file_path . basename($_FILES['product_image']['name']);
        if(!move_uploaded_file($_FILES['product_image']['tmp_name'],$uploaded_file)){
            if($language == "tr"){
                header("location:/tr/teknikdestek?file_error=true");
            }
            else if($language == "en"){
                header("location:/en/technicsupport?file_error=true");
            }
        }
        $image = $_FILES['product_image']['name'];      
        $result = mysqli_query($connection,"INSERT INTO technic_support(ts_email,ts_name,ts_order,ts_subject,ts_image,ts_info,ts_reply_check) VALUES('$email','$name','$order_code','$subject','$image','$info',0)");
        if($result){
            if($language == "tr"){
                header("location:/tr/sikayettakip?success=true");
            }
            else if($language == "en"){
                header("location:/en/complainttrackings?success=true");
            }
        }else{
            if($language == "tr"){
                echo '<div class="alert alert-danger">Formu doğru doldurduğunuzdan emin olun!</div><br>';
            }
            else if($language == "en"){
                echo '<div class="alert alert-success">Formu doldurduğunuzdan emin olun!</div>';
            }
        }  
    }
?>