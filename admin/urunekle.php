<?php require('adminIncludes/header.php'); ?>
<h3>Ürün Ekle</h3>
<?php 

if(isset($_GET["error"])){
    echo '<div class="alert alert-danger">Hata! Bilgileri eksiksiz girdiğinizden emin olun.</div>';
}
if(isset($_GET["success"])){
    echo '<div class="alert alert-success">Ürün başarıyla eklendi!</div><br>';
}

if(isset($_GET["update"])){
    if($_GET["update"] == 'true'){
        echo '<div class="alert alert-success">Ürün başarıyla güncellendi!</div><br>';
    }
    else if($_GET["update"] == 'false'){
        echo '<div class="alert alert-warning">Ürün güncellenemedi. Bilgileri doğru girdiğinizden emin olun ve tekrar deneyin.</div>';
    }else{
        echo '<div class="alert alert-danger">Hata!</div>';
    }
}

if($_POST){
    include('adminIncludes/config.php');
    $title = $_POST['title'];
    $subtitle = $_POST['subtitle'];
    $category = $_POST['category'];
    $brand = $_POST['brand'];
    $model = $_POST['model'];
    $product_detail = $_POST['product_detail'];
    $price = $_POST['price'];
    $uploaded_file = '../static/media/products/' . basename($_FILES['image']['name']);

    if(!move_uploaded_file($_FILES['image']['tmp_name'],$uploaded_file)){
        header("location:/admin/urunekle?error=true");
    }

    $image = $_FILES['image']['name'];
    $stock_amount = $_POST['stock_amount'];
    $query = "INSERT INTO products(title,subtitle,category,brand,model,product_detail,price,product_image,stock_amount) VALUES('$title','$subtitle','$category','$brand','$model','$product_detail','$price','$image','$stock_amount')";
    $result = mysqli_query($connection,$query);
    if($result){
        header("Location:/admin/urunler?success=true");
    }else{
        header("location:/admin/urunekle?error=true");
    }
}
?>
<a href="/admin/" class="btn btn-info">Geri</a>
<a href="/admin/urunler" class="btn btn-success">Ürünler</a>
<br>
<div class="row" style="margin-bottom:50px;">
<div class="col-md-5">
    <form action="/admin/urunekle" method="post" enctype = "multipart/form-data">
    <dt><label for="title">Başlık:</label>
    <dd><input class="form-control" id="title" name="title" type="text" value="">
    </dd>  
    <dt><label for="subtitle">Alt Başlık:</label>
    <dd><input class="form-control" id="subtitle" name="subtitle" type="text" value="">
    </dd>
    <select name="category">
    <option value="" selected>Kategori Seç</option>
    <?php 
        include('adminIncludes/config.php');
        $categories = mysqli_query($connection,"SELECT * FROM categories");
        if(isset($categories)){
            while($category = mysqli_fetch_array($categories)){
            echo'
            <option class="dropdown-item" value="'.$category['category_name'].'">'.$category['category_name'].'</option>
            ';
            }
        }
    ?>
    </select><br>
    <a href="/admin/kategoriekle">Kategori Ekle</a><br>
    <br>
    <dt><label for="brand">Marka:</label>
    <dd><input class="form-control" id="brand" name="brand" type="text" value="">
    </dd>
    <dt><label for="model">Model:</label>
    <dd><input class="form-control" id="model" name="model" type="text" value="">
    </dd>    
    <dt><label for="product_detail">Ürün Detayı:</label>
    <dd><textarea class="form-control" id="product_detail" name="product_detail"></textarea>
    </dd> 
    <dt><label for="price">Ürün Fiyatı:</label>
    <dd><input class="form-control" id="price" name="price" type="text" value="">  
    </dd> 
    <dt><label for="image">Ürün Fotoğrafı:</label>
    <dd><input class="form-control" id="image" name="image" type="file">
    </dd> 
    <dt><label for="stock_amount">Stok Girdisi:</label>
    <dd><input class="form-control" id="stock_amount" name="stock_amount" type="text" value="">
    </dd>
    <button type="submit" class="btn btn-success">Kaydet</button>
    </form>
    </div>
    </div>
    </div>
</div>

<?php require('adminIncludes/footer.php'); ?>